[respond]
[include chopper_tune.cfg]
[include fluidd.cfg]
[include timelapse.cfg]
[include get_ip.cfg]
[include Macro.cfg]
[include plr.cfg]
[include KAMP_Settings.cfg]
[mcu] 
canbus_uuid: 0d1445047cdd
[mcu extruder_mcu]
canbus_uuid: 61755fe321ac

[lis2dw]
cs_pin: extruder_mcu:PB12
spi_software_sclk_pin: extruder_mcu:PB13
spi_software_mosi_pin: extruder_mcu:PB15
spi_software_miso_pin: extruder_mcu:PB14
axes_map: x,z,y

[exclude_object]

[gcode_arcs]
resolution: 1.0

[resonance_tester]
accel_chip: lis2dw
probe_points:
    76, 76, 30  
accel_per_hz: 100
min_freq: 1
max_freq: 150
max_smoothing: 0.25
hz_per_sec: 1.0

[temperature_sensor mcu_temp]         
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor Host_temp]     
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor Toolhead_Temp]
sensor_type: temperature_mcu
sensor_mcu: extruder_mcu

[virtual_sdcard] 
path: /home/sovol/printer_data/gcodes/

[printer]
kinematics: corexy
max_velocity: 600           
max_accel: 15500             
minimum_cruise_ratio: 0.5    
max_z_velocity: 20           
max_z_accel: 500             
square_corner_velocity: 3.0  

[input_shaper]
shaper_type_x: ei
shaper_freq_x: 82.2
damping_ratio_x: 0.042
shaper_type_y: mzv
shaper_freq_y: 48.2
damping_ratio_y: 0.042

[probe_eddy_current eddy]
sensor_type: ldc1612
z_offset: 3.5
i2c_mcu: extruder_mcu
i2c_bus: i2c2
x_offset: -19.8
y_offset: -0.75
vir_contact_speed: 3.0

[z_offset_calibration]
non_contact_probe: probe_eddy_current eddy
contact_probe: probe_eddy_current eddy
endstop_xy_position: 76.2,76.2                        
z_hop: 2                       
z_hop_speed: 15
internal_endstop_offset: -0.20 

[safe_z_home]
home_xy_position: 96,76.2
speed: 90.0
z_hop: 5
z_hop_speed: 10.0

[bed_mesh]
speed: 300
horizontal_move_z: 2.0
algorithm: bicubic 
mesh_min: 12,12            
mesh_max: 132,140 
probe_count: 40,40
fade_start: 0
fade_end: 20
scan_overshoot: 3
            
[stepper_x]   
step_pin: PE1
dir_pin: !PD7
enable_pin: !PD5
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200
endstop_pin: ^extruder_mcu:PA10
position_min: -10
position_endstop: -10
position_max: 155
homing_speed: 90
homing_retract_dist: 2

[tmc5160 stepper_x]
cs_pin: PE0
spi_software_mosi_pin: PB6
spi_software_miso_pin: PB5
spi_software_sclk_pin: PB4
interpolate: true
run_current: 3.5
sense_resistor: 0.05
stealthchop_threshold: 999999
driver_TBL: 2
driver_TOFF: 5
driver_HSTRT: 3
driver_HEND: 8

[stepper_y]  
step_pin: PD3
dir_pin: !PD2
enable_pin: !PD0
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200
endstop_pin: ^PD1
position_min: -2
position_endstop: 152.5
position_max: 152.5
homing_speed: 90
homing_retract_dist: 2

[tmc5160 stepper_y]
cs_pin: PD4
spi_software_mosi_pin: PB6
spi_software_miso_pin: PB5
spi_software_sclk_pin: PB4
interpolate: true
run_current: 3.5
sense_resistor: 0.05
stealthchop_threshold: 999999
driver_TBL: 2
driver_TOFF: 5
driver_HSTRT: 3
driver_HEND: 8

[stepper_z] 
step_pin:PA5
dir_pin: !PA4   
enable_pin:!PA7
rotation_distance: 4             
microsteps: 16 
endstop_pin: probe:z_virtual_endstop  
position_max: 155
position_min: -5
homing_speed: 10.0
homing_retract_dist: 3.0
homing_retract_speed: 5.0
second_homing_speed: 5

[tmc2209 stepper_z]
uart_pin: PA6
interpolate: true             
run_current: 1.5                  
sense_resistor: 0.150          
uart_address:3

[adc_temperature my_thermistor_e]
temperature1:25
resistance1:1268.60
temperature2:180
resistance2:1920.98
temperature3:300
resistance3:2398.52

[extruder]
step_pin: extruder_mcu:PA8   
dir_pin: extruder_mcu:PA9
enable_pin: !extruder_mcu: PA11   
rotation_distance: 6.5 
microsteps: 16                
full_steps_per_rotation: 200 
nozzle_diameter: 0.400        
filament_diameter: 1.75  
max_extrude_only_distance: 150     
max_extrude_cross_section: 60
heater_pin: extruder_mcu:PB7 
sensor_type: my_thermistor_e  
pullup_resistor: 11500
sensor_pin: extruder_mcu:PA5  
min_temp: 0   
max_temp: 355                
max_power: 1.0                
min_extrude_temp: 150         
control : pid
pid_kp : 34.838
pid_ki : 4.976
pid_kd : 62.823
pressure_advance: 0.025       
pressure_advance_smooth_time: 0.025   

[tmc2209 extruder]
uart_pin: extruder_mcu:PA12
interpolate: True             
run_current: 0.8                       
uart_address: 3
sense_resistor: 0.150          

[verify_heater extruder]      
max_error: 120                
check_gain_time:20           
hysteresis: 5                
heating_gain: 2               

[filament_switch_sensor filament_sensor]
pause_on_runout: False
switch_pin: PB2
runout_gcode:
    M117 Out of Filament
    CONTINUE_PRINT_D D={200}

[thermistor my_thermistor]
temperature1: 25
resistance1: 100000
temperature2: 50
resistance2: 18085.4
temperature3: 100
resistance3: 5762.6

[heater_bed]
heater_pin: PD12
sensor_type: my_thermistor  
sensor_pin: PC5
max_power: 1.0               
min_temp: -0            
max_temp: 125             
control : pid
pid_kp : 53.071
pid_ki : 1.792
pid_kd : 442.428

[verify_heater heater_bed]      
max_error: 120                
check_gain_time:20           
hysteresis: 5                
heating_gain: 2 

[fan_generic fan0] # fan
pin: extruder_mcu:PB0
max_power: 1.0
cycle_time: 0.015

[fan_generic fan2] # auxiliary fan
pin: PE11
max_power: 1.0
cycle_time: 0.015

[fan_generic fan3]
pin: PE14
max_power: 1.0
cycle_time: 0.015

[temperature_fan exhaust_fan]  
pin: PB0                      
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PC4
max_power: 0.8                  
shutdown_speed: 0   
kick_start_time: 0.5
cycle_time: 0.01
off_below: 0.1
min_temp: 0                     
max_temp: 80                 
target_temp: 32 
max_delta: 1.0
control: watermark
gcode_id: D
tachometer_pin: PB1
tachometer_ppr: 1
tachometer_poll_interval: 0.0046

[heater_fan hotend_fan]      
pin: extruder_mcu:PA6   
max_power: 1.0      
cycle_time: 0.015         
kick_start_time: 0.5         
heater: extruder             
heater_temp: 45              
tachometer_pin: extruder_mcu:PA1
tachometer_ppr: 1
tachometer_poll_interval: 0.0013

[firmware_retraction]
retract_length: 0.6
retract_speed: 40
unretract_extra_length: 0
unretract_speed: 35

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PA8,   EXP1_2=PC9,
    EXP1_3=PA10,  EXP1_4=PA9,
    EXP1_5=PC11,  EXP1_6=PC10,
    EXP1_7=PD8,   EXP1_8=PC12,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PB14,  EXP2_2=PB13,
    EXP2_3=PC7,   EXP2_4=PB12,
    EXP2_5=PC6,   EXP2_6=PB15,
    EXP2_7=PC8,   EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=<5V>

[display]                    
lcd_type: uc1701
cs_pin: EXP1_3
a0_pin: EXP1_4
rst_pin: EXP1_5
encoder_pins: ^EXP2_5, ^EXP2_3
click_pin: ^!EXP1_2
contrast: 63
spi_software_miso_pin: EXP2_1
spi_software_mosi_pin: EXP2_6
spi_software_sclk_pin: EXP2_2

[neopixel Screen_Colour]     
pin: EXP1_6
chain_count: 3
color_order: RGB             
initial_RED: 1.0             
initial_GREEN: 1.0         
initial_BLUE: 1.0                     

[output_pin main_led]
pin:PD13
value:1

[idle_timeout]
gcode: _IDLE_TIMEOUT
timeout: 1800

[save_variables]
filename =/home/sovol/printer_data/config/saved_variables.cfg

[gcode_macro update_git]
gcode:
    {% set message = params.MESSAGE|default() %}
    {% if message %}
        RUN_SHELL_COMMAND CMD=update_git_script_message PARAMS="'{params.MESSAGE}'"
    {% else %}
        RUN_SHELL_COMMAND CMD=update_git_script
    {% endif %}

[gcode_shell_command update_git_script]
command: bash -c "bash $HOME/klipper-backup/script.sh"
timeout: 90.0
verbose: True

[gcode_shell_command update_git_script_message]
command: bash -c "bash $HOME/klipper-backup/script.sh -c \"$0\""
timeout: 90.0
verbose: True

[gcode_macro update_git_fix]
gcode:
    RUN_SHELL_COMMAND CMD=update_git_script_fix

[gcode_shell_command update_git_script_fix]
command: bash -c "bash $HOME/klipper-backup/script.sh --fix"
timeout: 90.0
verbose: True

[shaketune]
result_folder: ~/printer_data/config/ShakeTune_results
#    Path where the processed results will be stored. If the folder doesn't exist,
#    it will be automatically created. You can change this if you'd like to store 
#    results in a different location.
number_of_results_to_keep: 10
#    This setting defines how many results you want to keep in the result folder.
#    Once the specified number is exceeded, older results will be automatically deleted
#    to free up space on the SD card and avoid cluttering the results folder.
keep_raw_data: False
#    If set to True, Shake&Tune will store both the processed graphs and the raw accelerometer
#    .stdata files in the results folder. This can be useful for debugging or archiving purposes.
#    Please always attach them when reporting any issues on GitHub or Discord.
show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for system commands (macros that are not part
#    of the printer.cfg file). This option allow Shake&Tune to inject them into the webui at runtime.
#    If set to False, the macros will be hidden but still accessible from the console by typing
#    their names manually, which can be useful if you prefer to encapsulate them into your own macros.
timeout: 600
#    This defines the maximum processing time (in seconds) to allows to Shake&Tune for generating 
#    graphs from a .stdata file. 10 minutes should be more than enough in most cases, but if you have
#    slower hardware (e.g., older SD cards or low-performance devices), increase it to prevent timeouts.
measurements_chunk_size: 2
#    Each Shake&Tune command uses the accelerometer to take multiple measurements. By default,
#    Shake&Tune will write a chunk of data to disk every two measurements, and at the end of the
#    command will merge these chunks into the final .stdata file for processing. "2" is a very
#    conservative setting to avoid Klipper Timer Too Close errors on lower end devices with little
#    RAM, and should work for everyone. However, if you are using a powerful computer, you may
#    wish to increase this value to keep more measurements in memory (e.g., 15-20) before writing
#    the chunk and avoid stressing the filesystem too much.
max_freq: 200
#    This setting defines the maximum frequency at which the calculation of the power spectral density
#    is cutoff. The default value should be fine for most machines and accelerometer combinations and
#    avoid touching it unless you know what you're doing.
dpi: 300
#    Controls the resolution of the generated graphs. The default value of 300 dpi was optimized
#    and strikes a balance between performance and readability, ensuring that graphs are clear
#    without using too much RAM to generate them. Usually, you shouldn't need to change this value.

[auto_speed]
#axis: diag_x, diag_y  ; One or multiple of `x`, `y`, `diag_x`, `diag_y`, `z`
margin: 30            ; How far away from your axes to perform movements
#settling_home: 1      ; Perform settling home before starting Auto Speed
#max_missed: 1.0       ; Maximum full steps that can be missed
#endstop_samples: 3    ; How many endstop samples to take for endstop variance
accel_min: 100.0     ; Minimum acceleration test may try
accel_max: 20000.0    ; Maximum acceleration test may try
#accel_accu: 0.05      ; Keep binary searching until the result is within this percentage
velocity_min: 50.0    ; Minimum velocity test may try
velocity_max: 2000.0  ; Maximum velocity test may try
#velocity_accu: 0.05   ; Keep binary searching until the result is within this percentage
#derate: 0.8           ; Derate discovered results by this amount
#validate_margin: Unset      ; Margin for VALIDATE, Defaults to margin
#validate_inner_margin: 20.0 ; Margin for VALIDATE inner pattern
#validate_iterations: 50     ; Perform VALIDATE pattern this many times
results_dir: ~/printer_data/config/KAS ; Destination directory for graphs

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 39.8
#*# shaper_type_y = zv
#*# shaper_freq_y = 42.6
#*#
#*# [probe_eddy_current eddy]
#*# calibrate =
#*# 	0.050000:6066574.540,0.090000:6063891.664,0.130000:6060965.151,
#*# 	0.170000:6057939.336,0.210000:6054998.260,0.250000:6052281.600,
#*# 	0.290000:6049601.786,0.330000:6046869.123,0.370000:6044228.487,
#*# 	0.410000:6041765.362,0.450000:6039344.113,0.490000:6036843.538,
#*# 	0.530000:6034510.188,0.570000:6032164.630,0.610000:6029908.173,
#*# 	0.650000:6027744.658,0.690000:6025510.947,0.730000:6023373.127,
#*# 	0.770000:6021359.164,0.810000:6019370.288,0.850000:6017302.989,
#*# 	0.890000:6015366.867,0.930000:6013511.464,0.970000:6011707.507,
#*# 	1.010000:6009897.675,1.050000:6008066.758,1.090000:6006314.918,
#*# 	1.130000:6004654.225,1.170000:6003054.730,1.210000:6001225.408,
#*# 	1.250000:5999600.198,1.290000:5998339.307,1.330000:5996847.630,
#*# 	1.370000:5995297.101,1.410000:5993838.955,1.450000:5992460.310,
#*# 	1.490000:5991101.656,1.530000:5989685.607,1.570000:5988364.384,
#*# 	1.610000:5987073.008,1.650000:5985812.489,1.690000:5984538.275,
#*# 	1.730000:5983340.191,1.770000:5982142.076,1.810000:5980989.117,
#*# 	1.850000:5979861.896,1.890000:5978704.629,1.930000:5977564.149,
#*# 	1.970000:5976508.193,2.010000:5975488.283,2.050000:5974459.187,
#*# 	2.090000:5973437.942,2.130000:5972463.991,2.170000:5971536.387,
#*# 	2.210000:5970603.187,2.250000:5969628.171,2.290000:5968702.007,
#*# 	2.330000:5967816.043,2.370000:5966939.412,2.410000:5966072.663,
#*# 	2.450000:5965218.127,2.490000:5964417.454,2.530000:5963617.157,
#*# 	2.570000:5962781.884,2.610000:5961988.211,2.650000:5961235.873,
#*# 	2.690000:5960496.191,2.730000:5959716.102,2.770000:5958992.432,
#*# 	2.810000:5958277.952,2.850000:5957599.770,2.890000:5956932.843,
#*# 	2.930000:5956245.809,2.970000:5955555.160,3.010000:5954923.909,
#*# 	3.050000:5954281.099,3.090000:5953627.443,3.130000:5953043.360,
#*# 	3.170000:5952440.131,3.210000:5951833.513,3.250000:5951237.440,
#*# 	3.290000:5950665.019,3.330000:5950126.615,3.370000:5949584.302,
#*# 	3.410000:5949033.782,3.450000:5948487.777,3.490000:5947944.112,
#*# 	3.530000:5947473.176,3.570000:5946924.768,3.610000:5946447.114,
#*# 	3.650000:5945935.238,3.690000:5945493.951,3.730000:5945017.889,
#*# 	3.770000:5944530.480,3.810000:5944079.489,3.850000:5943649.113,
#*# 	3.890000:5943217.330,3.930000:5942788.011,3.970000:5942334.622,
#*# 	4.010000:5941932.894,4.050000:5941690.251
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.077197, 0.091109, 0.098972, 0.101204, 0.104327, 0.110272, 0.118802, 0.122357, 0.122357, 0.129288, 0.134443, 0.137332, 0.137998, 0.138800, 0.138456, 0.142722, 0.155396, 0.167208, 0.175374, 0.181370
#*# 	0.058662, 0.074269, 0.083052, 0.091834, 0.097324, 0.105083, 0.115247, 0.119512, 0.121646, 0.126622, 0.135688, 0.141088, 0.143112, 0.147377, 0.150967, 0.150229, 0.162997, 0.179155, 0.186538, 0.188753
#*# 	0.052352, 0.073487, 0.085247, 0.095128, 0.099154, 0.109548, 0.120935, 0.125201, 0.129288, 0.137321, 0.146666, 0.151705, 0.155396, 0.160564, 0.162963, 0.168533, 0.182108, 0.194633, 0.203447, 0.208624
#*# 	0.047626, 0.066556, 0.077929, 0.088174, 0.096226, 0.104326, 0.115958, 0.122356, 0.126628, 0.134443, 0.145955, 0.152444, 0.157616, 0.163517, 0.167947, 0.171856, 0.183031, 0.200505, 0.207933, 0.208630
#*# 	0.052352, 0.072029, 0.085986, 0.094763, 0.103436, 0.115247, 0.126622, 0.128755, 0.133732, 0.148088, 0.157980, 0.164255, 0.167946, 0.174680, 0.178417, 0.186907, 0.199037, 0.213849, 0.221191, 0.226330
#*# 	0.057090, 0.071291, 0.084515, 0.097324, 0.106735, 0.115247, 0.128761, 0.136622, 0.136576, 0.148621, 0.162963, 0.170899, 0.175465, 0.181370, 0.185061, 0.191329, 0.203447, 0.217520, 0.226330, 0.225596
#*# 	0.069759, 0.086718, 0.098476, 0.106523, 0.117025, 0.130177, 0.140979, 0.144533, 0.150229, 0.164071, 0.176873, 0.182108, 0.187276, 0.194633, 0.197569, 0.206810, 0.218988, 0.233458, 0.240356, 0.243157
#*# 	0.077929, 0.091835, 0.104278, 0.112759, 0.120224, 0.131599, 0.145198, 0.151705, 0.156134, 0.166285, 0.181370, 0.188015, 0.193898, 0.200505, 0.208586, 0.211215, 0.224862, 0.235524, 0.245957, 0.245267
#*# 	0.092615, 0.110272, 0.118802, 0.126621, 0.133021, 0.146488, 0.159826, 0.164255, 0.170161, 0.182108, 0.194082, 0.200689, 0.205644, 0.213115, 0.219723, 0.226330, 0.237768, 0.250310, 0.257042, 0.259804
#*# 	0.100667, 0.113115, 0.123960, 0.132310, 0.138089, 0.145955, 0.158350, 0.169423, 0.172963, 0.183591, 0.194633, 0.201239, 0.207113, 0.214032, 0.221191, 0.227804, 0.238285, 0.249409, 0.258424, 0.263802
#*# 	0.115391, 0.126622, 0.134488, 0.141690, 0.148799, 0.162409, 0.169088, 0.172421, 0.179848, 0.192430, 0.204953, 0.210664, 0.216235, 0.224862, 0.230692, 0.238324, 0.249448, 0.261185, 0.266363, 0.269476
#*# 	0.116669, 0.125555, 0.136255, 0.143823, 0.149510, 0.158350, 0.165732, 0.173517, 0.178568, 0.188753, 0.202708, 0.210136, 0.214583, 0.221742, 0.227799, 0.232763, 0.244537, 0.254971, 0.264810, 0.269470
#*# 	0.127225, 0.131954, 0.140887, 0.147377, 0.154658, 0.163517, 0.173585, 0.178538, 0.183585, 0.193898, 0.208624, 0.213849, 0.220090, 0.227248, 0.232763, 0.238285, 0.250829, 0.263256, 0.268435, 0.269471
#*# 	0.122894, 0.129288, 0.138846, 0.144533, 0.149510, 0.157611, 0.168534, 0.175736, 0.178372, 0.188014, 0.198303, 0.206378, 0.214583, 0.222292, 0.228533, 0.231382, 0.240395, 0.250790, 0.262221, 0.265365
#*# 	0.127379, 0.137355, 0.144487, 0.150230, 0.154658, 0.164255, 0.176157, 0.180816, 0.185800, 0.196835, 0.209401, 0.214584, 0.221191, 0.228900, 0.232072, 0.238285, 0.250139, 0.261185, 0.266364, 0.269989
#*# 	0.124489, 0.134443, 0.141644, 0.146672, 0.151705, 0.158349, 0.167946, 0.175465, 0.179893, 0.190228, 0.201283, 0.211247, 0.216235, 0.223394, 0.230692, 0.230692, 0.243195, 0.260695, 0.264810, 0.268127
#*# 	0.129512, 0.141598, 0.149121, 0.150967, 0.156140, 0.166469, 0.176157, 0.178372, 0.184138, 0.199037, 0.214540, 0.216052, 0.219723, 0.227248, 0.230001, 0.236944, 0.250139, 0.261185, 0.267399, 0.268435
#*# 	0.123423, 0.133021, 0.140933, 0.145955, 0.150230, 0.156873, 0.165182, 0.170945, 0.175374, 0.187276, 0.199771, 0.206195, 0.210092, 0.216052, 0.221925, 0.222659, 0.235697, 0.254452, 0.263256, 0.260494
#*# 	0.119513, 0.134489, 0.141087, 0.141122, 0.145961, 0.156873, 0.165732, 0.169468, 0.173517, 0.185800, 0.197569, 0.201239, 0.204910, 0.211603, 0.214583, 0.220457, 0.234839, 0.247338, 0.252900, 0.252210
#*# 	0.110983, 0.115958, 0.118091, 0.119513, 0.121290, 0.130888, 0.139511, 0.146666, 0.150967, 0.162041, 0.173551, 0.178372, 0.180631, 0.187276, 0.190228, 0.188752, 0.197936, 0.216009, 0.227065, 0.229266
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 12.0
#*# max_x = 131.89
#*# min_y = 12.0
#*# max_y = 139.87000000000003
